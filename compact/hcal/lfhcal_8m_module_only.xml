<lccdd>

  <info name="lfhcal_8m_module_only.xml"
        title="EPIC LFHCAL Single 8M Module"
        author="@FriederikeBock"
        url="https://github.com/FriederikeBock"
        status="development"
        version="1.0"
  ><comment/></info>

  <define>
    <include ref="lfhcal/module_definitions.xml"/>

    <comment>
    <comment> Override the number of tiles in x and y for testbeam (untested) </comment>
    <constant name="EightM_xArr"              value="4" />
    <constant name="EightM_yArr"              value="2" />
    </comment>

    <comment>
    <documentation>
      #### Material Thickness
    </documentation>
    <constant name="LFHCALAbsorberThickness"      value="1.52* cm"/>
    <constant name="LFHCALPolystyreneThickness"   value="0.4* cm"/>
    <constant name="LFHCALKaptonThickness"        value="0.08* cm"/>
    <constant name="LFHCALAirOffset"              value="0.05* cm"/>
    <constant name="LFHCALElectronicsThickness"   value="10.0* cm"/>
    <documentation>
      - Hcal Endcap N Layers and computed Thickness
    </documentation>

    <comment> FIXME: Need actual values once they are decided upon </comment>
    <constant name="LFHCALLayer_NSteelRepeatSFirst"    value="5"/> <!--      6 x 10 steel layers -->
    <constant name="LFHCALLayer_NSteelRepeatS"    value="10"/> <!--      6 x 10 steel layers -->
    <constant name="LFHCALLayer_NTungstenRepeat"  value="0"/>
    <constant name="Mod_MountingPlateThickness" value="25.4* mm"/>
    <constant name="Mod_SideWallThickness"    value="1.9* mm"/>
    <constant name="Mod_TopWallThickness"     value="1.9* mm"/>
    <constant name="Mod_FrontWallThickness"   value="15* mm"/>
    <constant name="Mod_BackWallThickness"    value="15* mm"/>
    <constant name="Mod_NotchDepth"           value="5* mm"/>
    <constant name="Mod_NotchHeight"          value="78* mm"/>
    <constant name="Mod_FoilThick"            value="0.1* mm"/>
    <constant name="Mod_PCBWidth"             value="70* mm"/>
    <constant name="Mod_PCBThickness"         value="4* mm"/>
    <constant name="Mod_PCBLength"            value="125* cm"/>


    <constant name="EightM_xArr"              value="4" />
    <constant name="EightM_yArr"              value="2" />
    <constant name="EightM_OuterWidth"        value="20.188* cm"/>
    <constant name="EightM_OuterHeight"       value="10.1* cm"/>
    <constant name="EightM_BackInnerWidth"    value="15.0* cm"/>
    <constant name="EightM_BackInnerHeight"   value="7.0* cm"/>
    <constant name="FourM_xArr"               value="2" />
    <constant name="FourM_yArr"               value="2" />
    <constant name="FourM_OuterWidth"         value="10.094* cm"/>
    <constant name="FourM_OuterHeight"        value="10.1* cm"/>
    <constant name="FourM_BackInnerWidth"     value="7.0* cm"/>
    <constant name="FourM_BackInnerHeight"    value="7.0* cm"/>
    <constant name="FourM_NotchHeight"        value="75* mm"/>

    </comment>

  </define>

  <display>
    <vis name="LFHCAL8MModVis"          ref="AnlBlue"       showDaughters="true"  visible="true"/>
    <vis name="LFHCAL4MModVis"          ref="AnlViolet"     showDaughters="true"  visible="true"/>
    <vis name="LFHCAL8MModOuter"        ref="AnlBlue"       showDaughters="true"  visible="true"/>
    <vis name="LFHCALLayerScintVis"     ref="AnlLight_Gray" showDaughters="false" visible="true"/>
    <vis name="LFHCALLayerSteelVis"     ref="AnlRed"        showDaughters="false" visible="true"/>
    <vis name="LFHCALLayerTungstenVis"  ref="AnlViolet"     showDaughters="false" visible="true"/>
    <vis name="LFHCALLayerKaptonVis"    ref="AnlGold"       showDaughters="false" visible="true"/>
    <vis name="LFHCALLayerFoilVis"      ref="AnlGray"       showDaughters="false" visible="true"/>
    <vis name="LFHCALModPCB"            ref="AnlDarkGreen"  showDaughters="false" visible="true"/>
 </display>

  <!-- Define detector -->
  <detectors>
    <documentation>
      ### Forward (Positive Z) Endcap Hadronic Calorimeter

      This is the ECCE LFHCAL design without individual tower placements and electronics
      The original design was 60 layers of Steel/Sc and 10 layers of W/Sc, both 1.6 cm/0.4 cm
      This is too long, so 5 layers of tungsten were removed as a placeholder until the final design is chosen

      The HCal forward insert shape is cut out from this detector

      Currently don't have an implementation of electronics, so just leave that area (final 10 cm) empty
      So then, actual detector area is "LFHCAL_length - LFHCALElectronicsThickness" long
    </documentation>
    <detector
      id="LFHCAL_ID"
      name="LFHCAL"
      type="epic_LFHCAL_TestBeam"
      readout="LFHCALHits"
      vis="InvisibleWithDaughters"
      calorimeterType="HAD_ENDCAP"
      renderComponents="1"
      allSensitive="0"
      >

      <position x="0" y="0" z="0"/>
      <dimensions
        z="LFHCAL_length"
        rmin="20*cm"
        rmax="LFHCAL_rmax"
        x="EightM_OuterWidth"
        y="EightM_OuterHeight"
        x0="-FourM_OuterWidth"/>
      <envelope material="Steel235"/>

      <eightmodule name="8MModule" vis="InvisibleWithDaughters" repeat="0" >
        <dimensions
        width="EightM_OuterWidth"
        height="EightM_OuterHeight"
        widthBackInner="EightM_BackInnerWidth"
        heightBackInner="EightM_BackInnerHeight"
        widthSideWall="Mod_SideWallThickness"
        widthTopWall="Mod_TopWallThickness"
        thicknessMountingPlate="Mod_MountingPlateThickness"
        thicknessFrontWall="Mod_FrontWallThickness"
        thicknessBackWall="Mod_BackWallThickness"
        arrayX="EightM_xArr"
        arrayY="EightM_yArr"
        notchDepth="Mod_NotchDepth"
        notchHeight="Mod_NotchHeight"
        foilThick="Mod_FoilThick"
        pcbLength="Mod_PCBLength"
        pcbThick="Mod_PCBThickness"
        pcbWidth="Mod_PCBWidth"
        />
        <position x="50*cm" y="50*cm" z="LFHCAL_length - LFHCALElectronicsThickness" />
      </eightmodule>
      <fourmodule name="4MModule" vis="InvisibleWithDaughters" repeat="2">
        <dimensions
        width="FourM_OuterWidth"
        height="FourM_OuterHeight"
        widthBackInner="FourM_BackInnerWidth"
        heightBackInner="FourM_BackInnerHeight"
        widthSideWall="Mod_SideWallThickness"
        widthTopWall="Mod_TopWallThickness"
        thicknessMountingPlate="Mod_MountingPlateThickness"
        thicknessFrontWall="Mod_FrontWallThickness"
        thicknessBackWall="Mod_BackWallThickness"
        arrayX="FourM_xArr"
        arrayY="FourM_yArr"
        notchDepth="Mod_NotchDepth"
        notchHeight="Mod_NotchHeight"
        foilThick="Mod_FoilThick"
        pcbLength="Mod_PCBLength"
        pcbThick="Mod_PCBThickness"
        pcbWidth="Mod_PCBWidth"
        />
        <position x="50*cm" y="60*cm" z="LFHCAL_length - LFHCALElectronicsThickness" />
      </fourmodule>
      <layer repeat="LFHCALLayer_NSteelRepeatSFirst" vis="InvisibleWithDaughters" readoutlayer="0">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>
      <layer repeat="LFHCALLayer_NSteelRepeatSFirst" vis="InvisibleWithDaughters" readoutlayer="1">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>
      <layer repeat="LFHCALLayer_NSteelRepeatS" vis="InvisibleWithDaughters" readoutlayer="2">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>
      <layer repeat="LFHCALLayer_NSteelRepeatS" vis="InvisibleWithDaughters" readoutlayer="3">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>
      <layer repeat="LFHCALLayer_NSteelRepeatS" vis="InvisibleWithDaughters" readoutlayer="4">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>
      <layer repeat="LFHCALLayer_NSteelRepeatS" vis="InvisibleWithDaughters" readoutlayer="5">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>
      <layer repeat="LFHCALLayer_NSteelRepeatS" vis="InvisibleWithDaughters" readoutlayer="6">
        <slice material="Polystyrene" thickness="LFHCALPolystyreneThickness" vis="LFHCALLayerScintVis" sensitive="yes" limits="cal_limits" type="3" />
        <slice material="Kapton" thickness="LFHCALKaptonThickness" vis="LFHCALLayerKaptonVis" type="2" offset="LFHCALAirOffset"/>
        <slice material="Steel235" thickness="LFHCALAbsorberThickness" vis="LFHCALLayerSteelVis" type="1"/>
      </layer>

      <documentation>
        ### for testing of a single module
      </documentation>
      <eightmodulepositions>
        <position x="0*mm" y="0*mm" z="0*mm"/>
      </eightmodulepositions>


      <documentation>
      ### positions of modules for full area LFHCAL (sorted by ascending r, x, y)
      </documentation>
      <fourmodulepositions>
      </fourmodulepositions>

    </detector>

  </detectors>

  <!--  Definition of the readout segmentation/definition  -->
  <readouts>
    <readout name="LFHCALHits">
      <segmentation type="NoSegmentation"/>
      <id>system:8,moduleIDx:6,moduleIDy:6,moduletype:1,passive:1,towerx:2,towery:1,rlayerz:4,layerz:4</id>
    </readout>
  </readouts>

</lccdd>
