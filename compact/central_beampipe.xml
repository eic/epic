<!-- SPDX-License-Identifier: LGPL-3.0-or-later -->
<!-- Copyright (C) 2022 Wouter Deconinck, Whitney Armstrong -->

<lccdd>
  <define>
    <constant name="IPBeampipeUpstreamStraightLength" value="74.8 * cm"/>
    <constant name="IPBeampipeDownstreamStraightLength" value="64.8 * mm"/>
    <constant name="BeampipeOD" value="62 * mm"/>
  </define>

  <display>
  </display>

  <detectors>

    <detector id="BeamPipe_ID" name="BeamPipe" type="IP6BeamPipe" vis="BeamPipeVis">
      <type_flags type="DetType_TRACKER + DetType_BEAMPIPE" />
      <beampipe/>
      <IP_pipe
	ID="IPBeampipeID"
        wall_thickness="0.757*mm"
	wall_material="Beryllium"
        coating_thickness="5*um"
	coating_material="Gold"
        crossing_angle="CrossingAngle"
        upstream_straight_length="IPBeampipeUpstreamStraightLength"
        downstream_straight_length="IPBeampipeDownstreamStraightLength"
      />

      <comment> For upstream beampipe, we subtract the vacuum from the matter </comment>
      <upstream reflect="true"
                place_vacuum="true">
        <outgoing_lepton wall_thickness="1.0 * mm"
		coating_thickness="30 * um">
          <zplane z="75.6 * cm" ID="IPBeampipeID"/>
          <zplane z="454.449 * cm" ID="IPBeampipeID"/>
        </outgoing_lepton>
        <incoming_hadron wall_thickness="1.65 * mm"
			 coating_thickness="30 * um"
                         crossing_angle="CrossingAngle">
          <zplane z="75.6 * cm" ID="2.527 * cm"/>
          <zplane z="247.298 * cm" ID="2.527 * cm"/>
          <zplane z="(247.298 + 2.54) * cm" ID="3.48 * cm"/>
          <zplane z="(247.298 + 2.54 + 170.2) * cm" ID="3.48 * cm"/>
          <zplane z="(247.298 + 2.54 + 170.2 + 1.27) * cm" ID="4.115 * cm"/>
          <zplane z="(247.298 + 2.54 + 170.2 + 1.27 + 32.769) * cm" ID="4.115 * cm"/>
        </incoming_hadron>
      </upstream>

      <comment> For downstream beampipe (where on is inside the vacuum of the other), we subtract the matter from the vacuum, and subtract an additional pipe to create the angled cutout</comment>
      <downstream reflect="false"
                  place_vacuum="true"
                  subtract_vacuum="false"
                  subtract_matter="true">
        <incoming_lepton thickness="1.0*mm">
          <zplane z="IPBeampipeDownstreamStraightLength" OD="BeampipeOD"/>
          <zplane z="4484.25 * mm" OD="BeampipeOD"/>
        </incoming_lepton>
        <outgoing_hadron thickness="4.0*mm"
                         axis_intersection="670.0 * mm"
                         crossing_angle="CrossingAngle">
          <!-- avoid overlap with IP beampipe by starting slightly displaced -->
          <zplane z="IPBeampipeDownstreamStraightLength + 0.5 * BeampipeOD * tan(abs(CrossingAngle))" OD="BeampipeOD"/>
          <zplane z="1750.00 * mm" OD=" 92.06 * mm"/>
          <zplane z="4455.80 * mm" OD="257.92 * mm"/>
          <!-- removed due to vacuum overlap with far forward electron beampipe -->
          <!--zplane z="5000.00 * mm" OD="340.60 * mm"/-->
        </outgoing_hadron>
        <additional_subtraction thickness="4.0*mm"
                                crossing_angle="CrossingAngle">
          <!-- these are somewhat arbitrary to get the right hole shape -->
          <zplane z="IPBeampipeDownstreamStraightLength" OD="32. * mm"/>
          <zplane z="4484.25 * mm" OD="120. * mm"/>
        </additional_subtraction>
      </downstream>
    </detector>

  </detectors>


</lccdd>
