<!-- SPDX-License-Identifier: LGPL-3.0-or-later -->
<!-- Copyright (C) 2022 Dmitry Romanov -->

<lccdd>
  <define>
    <comment>
      Transition area.
      The idea behind this parametrization is that:
      one glass module with its wrap is always
      a size of 4 crystal modules with its wraps.
      Then the transition area (where glass meets crystals) has no gaps

      +----------------+----------------+
      | +----+  +----+ |  +----------+  |
      | |    |  |    | |  |          |  |
      | +----+  +----+ |  |          |  |
      | +----+  +----+ |  |          |  |
      | |    |  |    | |  |          |  |
      | +----+  +----+ |  +----------+  |
      +----------------+----------------+
           crystal           glass

      This implies that:
        GlassModule_wrap = 2*CrystalModule_wrap
        GlassModule_sx = 2*CrystalModule_sx
        GlassModule_sy = 2*CrystalModule_sy

    </comment>

    <constant name="CrystalModule_width" value="20.00*mm"/>
    <constant name="CrystalModule_length" value="200.00*mm"/>
    <constant name="CrystalModule_wrap" value="0.50*mm"/>
    <constant name="CrystalModule_z0" value="0.0*cm"/>

    <constant name="GlassModule_width" value="2*CrystalModule_width"/>
    <constant name="GlassModule_length" value="55.00*cm"/>
    <constant name="GlassModule_wrap" value="2*CrystalModule_wrap"/>
    <constant name="GlassModule_z0" value="0.0*cm"/>

    <constant name="EcalEndcapNIonCutout_dphi" value="30*degree"/>

    <constant name="EcalEndcapN_thickness" value="GlassModule_length"/>
    <constant name="EcalEndcapN_z0" value="-EcalEndcapN_zmin - EcalEndcapN_thickness/2"/>
    <constant name="EcalEndcapNCrystal_rmax" value="100*cm"/> <!-- i.e. never -->

    <constant name="CrystalModule_distance" value="CrystalModule_width + CrystalModule_wrap"/>
    <constant name="GlassModule_distance" value="GlassModule_width + GlassModule_wrap"/>
  </define>

  <display>
    <vis name="HybridEcalOuterVis" alpha="0.5"  r= "0.3"  g="0.3"  b="0.3"  showDaughters="true" visible="true"/>
  </display>

  <detectors>

    <documentation level="10">
      #### Backwards Endcap EM Calorimeter

      Backwards Endcap EM Calorimeter, placements generated by script
    </documentation>
    <detector id="ECalEndcapN_ID" name="EcalEndcapN" type="epic_HybridCalorimeter" readout="EcalEndcapNHits">
      <position x="0" y="0" z="EcalEndcapN_z0"/>
      <rotation x="0" y="0" z="0"/>
    </detector>
  </detectors>
  <readouts>
    <comment>Effectively no segmentation, the segmentation is used to provide cell dimension info</comment>
    <readout name="EcalEndcapNHits">
      <segmentation type="MultiSegmentation" key="sector">
        <segmentation name="CrystalSeg" key_value="1" type="CartesianGridXY" grid_size_x="CrystalModule_distance" grid_size_y="CrystalModule_distance"/>
        <segmentation name="GlassSeg" key_value="2" type="CartesianGridXY" grid_size_x="GlassModule_distance" grid_size_y="GlassModule_distance"/>
      </segmentation>
      <id>system:8,sector:4,module:20,x:32:-16,y:-16</id>
    </readout>
  </readouts>
</lccdd>
