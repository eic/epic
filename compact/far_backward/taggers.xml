<!-- SPDX-License-Identifier: LGPL-3.0-or-later -->
<!-- Copyright (C) 2022 Wouter Deconinck, Simon Gardner -->

<lccdd>

  <define>

   <constant name="tracker_pixel_size" value="55*um"/>

  </define>

  <detectors>

    <detector id="TaggerTracker_ID" name="BackwardsTaggerStation" type="BackwardsTagger" readout="TaggerTrackerHits">

      <comment> Tagger stations </comment>
      <module id="1" name="Tagger1">
        <comment>
        Position and rotation refer to the center front of tagger assembly, this should line up with the back of the exit window
        Rotation Tagger1_Theta is relative to electron beamline axis, so we add 180deg to transform into detector coordinates
        </comment>
        <position    x="Tagger1_X" y="Tagger1_Y" z="Tagger1_Z"/>
        <rotation    x="0*deg" y="Tagger1_Theta+180*deg" z="0*deg"/>

        <dimensions  x="Tagger1_Width" y="Tagger1_Height"/>

        <comment> Where z is the position of the front face of the detector layer </comment>
        <trackLayer  id="0" type="timepix" z="3*mm"   sensor_thickness="400*um"/>
        <trackLayer  id="1" type="timepix" z="103*mm" sensor_thickness="400*um"/>
        <trackLayer  id="2" type="timepix" z="203*mm" sensor_thickness="400*um"/>
        <trackLayer  id="3" type="timepix" z="303*mm" sensor_thickness="400*um"/>
      </module>

      <module id="2" name="Tagger2">
        <comment> Position and rotation refer to the center front of tagger assembly, this should line up with the back of the exit window </comment>
        <position    x="Tagger2_X" y="Tagger2_Y" z="Tagger2_Z"/>
        <rotation    x="0*deg" y="Tagger2_Theta+180*deg" z="0*deg"/>

        <dimensions  x="Tagger2_Width" y="Tagger2_Height"/>

        <comment> Where z is the position of the front face of the detector layer </comment>
        <trackLayer  id="0" type="timepix" z="3*mm"   sensor_thickness="400*um"/>
        <trackLayer  id="1" type="timepix" z="103*mm" sensor_thickness="400*um"/>
        <trackLayer  id="2" type="timepix" z="203*mm" sensor_thickness="400*um"/>
        <trackLayer  id="3" type="timepix" z="303*mm" sensor_thickness="400*um"/>
      </module>

    </detector>

    <comment> Add calorimeter here... </comment>

  </detectors>


  <plugins>
    <plugin name="DD4hep_ParametersPlugin">
      <argument value="BackwardsTaggerStation"/>
      <argument value="layer_pattern: str=Tagger\d"/>
    </plugin>
  </plugins>


  <readouts>

    <readout name="TaggerTrackerHits">
      <segmentation type="CartesianGridXY" grid_size_x="tracker_pixel_size" grid_size_y="tracker_pixel_size" />
      <id>system:8,module:2,layer:4,sensor:4,x:32:-16,y:-16</id>
    </readout>

  </readouts>

</lccdd>
