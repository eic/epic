<!-- SPDX-License-Identifier: LGPL-3.0-or-later -->
<!-- Copyright (C) 2022 Simon Gardner, Dhevan Gangadharan -->

<lccdd>

  <comment>
     Incident hadron beam pipes
     Implemented to allow overlap checks with the far backwards systems
     See compact/far_forward/ion_beamline.xml for magnet element coordinate description
  </comment>


  <define>
    <!-- Q1ApR Yoke Center Position -->
    <constant name="Q1APR_Yoke_Center_posX" value="10.5099 * cm"/>
    <constant name="Q1APR_Yoke_Center_posY" value="0 * cm"/>
    <constant name="Q1APR_Yoke_Center_posZ" value="-619.783 * cm"/>
    <constant name="Q1APR_Yoke_Rotation_Angle" value="-0.025 * rad"/>
    <!-- Q1ApR Coil Center Position -->
    <constant name="Q1APR_Coil_Center_posX" value="15.5083 * cm"/>
    <constant name="Q1APR_Coil_Center_posY" value="0 * cm"/>
    <constant name="Q1APR_Coil_Center_posZ" value="-619.659 * cm"/>
    <!-- Q1BpR Yoke Center Position -->
    <constant name="Q1BPR_Yoke_Center_posX" value="6.32227 * cm"/>
    <constant name="Q1BPR_Yoke_Center_posY" value="0 * cm"/>
    <constant name="Q1BPR_Yoke_Center_posZ" value="-829.954 * cm"/>
    <constant name="Q1BPR_Yoke_Rotation_Angle" value="-0.025 * rad"/>
    <!-- Q1BpR Coil Center Position -->
    <constant name="Q1BPR_Coil_Center_posX" value="20.7578 * cm"/>
    <constant name="Q1BPR_Coil_Center_posY" value="0 * cm"/>
    <constant name="Q1BPR_Coil_Center_posZ" value="-829.593 * cm"/>
    <!-- Q2pR Yoke Center Position -->
    <constant name="Q2PR_Yoke_Center_posX" value="15.6655 * cm"/>
    <constant name="Q2PR_Yoke_Center_posY" value="0 * cm"/>
    <constant name="Q2PR_Yoke_Center_posZ" value="-1226.01 * cm"/>
    <constant name="Q2PR_Yoke_Rotation_Angle" value="-0.025 * rad"/>
    <!-- Q2pR Coil Center Position -->
    <constant name="Q2PR_Coil_Center_posX" value="31.888 * cm"/>
    <constant name="Q2PR_Coil_Center_posY" value="0 * cm"/>
    <constant name="Q2PR_Coil_Center_posZ" value="-1274.73 * cm"/>

  </define>

  <detectors>


    <comment> Hadron side beam magnet volumes </comment>

    <!-- Q1ApR magnet -->
    <detector name="Q1APR_BeamlineMagnet" type="ip6_CryostatMagnet">
      <yoke name="Q1APR_Yoke" vis="MagnetVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <dimensions rmin="0 * cm" rmax="50. * cm / 2." half_length="180. * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
        <cut shape="Cone">
          <placement x="5.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="12.6 * cm / 2." rmin2="0 * cm" rmax2="11.4 * cm / 2." dz="181.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut shape="Cone">
          <placement x="-10.519 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="7.6 * cm" rmin2="0 * cm" rmax2="6.8 * cm" dz="181.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="0 * cm" y="19.757 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.08 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="4" start="45.0 * deg" step="90.0 * deg" axis="Z"/>
        </cut>
      </yoke>
      <coil name="Q1APR_Coil" vis="MagnetCoilVis" shape="ConeSegment">
        <placement x="Q1APR_Coil_Center_posX" y="Q1APR_Coil_Center_posY" z="Q1APR_Coil_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle" phiNum="3" phiStart="90 * deg" phiStep="90 * deg"/>
        <dimensions rmin1="3.878580 * cm" rmax1="4.823460 * cm" rmin2="3.279140 * cm" rmax2="4.224020 * cm" dz="160.0 * cm / 2." sphi="-60. * deg / 2." dphi="60. * deg"/>
      </coil>
      <tube name="Q1APR_InnerSupport_Tube" vis="MagnetSupportTubeVis" shape="Cone">
        <placement x="Q1APR_Coil_Center_posX" y="Q1APR_Coil_Center_posY" z="Q1APR_Coil_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
          <dimensions rmin1="7.121052 * cm / 2." rmax1="3.8 * cm" rmin2="5.617656 * cm / 2." rmax2="3.2 * cm" dz="200.639934 * cm / 2."/>
      </tube>
      <endplate name="Q1APR_EndPlate_IP" vis="MagnetEndPlateVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <zplane z="-(180.0 * cm / 2. + 0.5 * cm)" rmin="0.0 * cm" rmax="50.0 * cm / 2."/>
        <zplane z="-(180.0 * cm / 2. + 1.905000 * cm)" rmin="0.0 * cm" rmax="50.0 * cm / 2."/>
        <cut shape="Cone">
          <placement x="5.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="7.92 * cm / 2." rmin2="0 * cm" rmax2="6.5 * cm / 2." dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut shape="Cone">
          <placement x="-10.519 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="6.8 * cm" rmin2="0 * cm" rmax2="6.0 * cm" dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="0 * cm" y="19.757 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.08 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="4" start="45.0 * deg" step="90.0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q1APR_EndPlate_nonIP" vis="MagnetEndPlateVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <zplane z="(180.0 * cm / 2. + 0.5 * cm)" rmin="0.0 * cm" rmax="50.0 * cm / 2."/>
        <zplane z="(180.0 * cm / 2. + 1.905000 * cm)" rmin="0.0 * cm" rmax="50.0 * cm / 2."/>
        <cut shape="Cone">
          <placement x="5.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="7.92 * cm / 2." rmin2="0 * cm" rmax2="6.5 * cm / 2." dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut shape="Cone">
          <placement x="-10.519 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="6.8 * cm" rmin2="0 * cm" rmax2="6.0 * cm" dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="0 * cm" y="19.757 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.08 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="4" start="45.0 * deg" step="90.0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q1APR_EndPlate2_IP" vis="MagnetEndPlateVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <zplane z="-(189.9 * cm / 2.)" rmin="0.0 * cm" rmax="52.539900 * cm / 2."/>
        <zplane z="-(189.9 * cm / 2. + 4.127500 * cm)" rmin="0.0 * cm" rmax="52.539900 * cm / 2."/>
        <cut shape="Cone">
          <placement x="5.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="7.92 * cm / 2." rmin2="0 * cm" rmax2="6.5 * cm / 2." dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut shape="Cone">
          <placement x="-10.519 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="6.8 * cm" rmin2="0 * cm" rmax2="6.0 * cm" dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="0 * cm" y="19.757 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.08 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="4" start="45.0 * deg" step="90.0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q1APR_EndPlate2_nonIP" vis="MagnetEndPlateVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <zplane z="(189.9 * cm / 2.)" rmin="0.0 * cm" rmax="52.539900 * cm / 2."/>
        <zplane z="(189.9 * cm / 2. + 4.127500 * cm)" rmin="0.0 * cm" rmax="52.539900 * cm / 2."/>
        <cut shape="Cone">
          <placement x="5.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="7.92 * cm / 2." rmin2="0 * cm" rmax2="6.5 * cm / 2." dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut shape="Cone">
          <placement x="-10.519 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="6.8 * cm" rmin2="0 * cm" rmax2="6.0 * cm" dz="200.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="0 * cm" y="19.757 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.08 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="4" start="45.0 * deg" step="90.0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <yokeshield name="Q1APR_YoketShield" vis="MagnetEndPlateVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <dimensions rmin="25. * cm" rmax="26.27 * cm" half_length="189.9 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </yokeshield>
      <heatshieldbarrel name="Q1APR_HeatShield_Barrel" vis="MagnetHeatShieldVis">
        <placement x="10.7196 * cm" y="0 * cm" z="-628.17 * cm" theta="Q1APR_Yoke_Rotation_Angle"/>
        <dimensions rmin="44.132500 * cm" rmax="44.450000 * cm" half_length="170.180000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </heatshieldbarrel>
      <cryobarrel name="Q1APR_Cryo_Barrel" vis="MagnetCryoVis">
        <placement x="10.719 * cm" y="0 * cm" z="-628.17 * cm" theta="Q1APR_Yoke_Rotation_Angle"/>
        <dimensions rmin="105.089960 * cm / 2." rmax="106.680000 * cm / 2." half_length="175.260000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </cryobarrel>
      <cryoend name="Q1APR_Cryo_End_IP" vis="MagnetCryoVis">
        <placement x="Q1APR_Yoke_Center_posX" y="Q1APR_Yoke_Center_posY" z="Q1APR_Yoke_Center_posZ" theta="Q1APR_Yoke_Rotation_Angle"/>
        <zplane z="(180.0 * cm / 2. - 10.7 * cm)" rmin="103.505000 * cm / 2." rmax="106.680000 * cm / 2."/>
        <zplane z="(180.0 * cm / 2. - 10.7 * cm + 30.0 * cm)" rmin="103.505000 * cm / 2." rmax="106.680000 * cm / 2."/>
        <zplane z="(180.0 * cm / 2. - 10.7 * cm + 30.0 * cm)" rmin="0 * cm / 2." rmax="106.680000 * cm / 2."/>
        <zplane z="(180.0 * cm / 2. - 10.7 * cm + 30.0 * cm + 1.588983 * cm)" rmin="0 * cm / 2." rmax="106.680000 * cm / 2."/>
        <cut shape="Cone">
          <placement x="5.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="6.5 * cm / 2." rmin2="0 * cm" rmax2="6.5 * cm / 2." dz="400.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut shape="Cone">
          <placement x="-10.519 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin1="0 * cm" rmax1="6. * cm" rmin2="0 * cm" rmax2="6. * cm" dz="400.0 * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </cryoend>
    </detector>

    <!-- Q1BpR magnet -->
    <detector name="Q1BPR_BeamlineMagnet" type="ip6_CryostatMagnet">
      <yoke name="Q1BPR_Yoke" vis="MagnetVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <dimensions rmin="0 * cm" rmax="71.12 * cm / 2." half_length="140. * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
        <cut>
          <placement x="14.44 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="10.662 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="(0.515283 + abs(0.515283-4.019476)/2. - 8.579) * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="17.157 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="0 * cm" y="25.144717 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.08 * cm / 2." half_length="400. * cm / 2."/>
          <rotation num="4" start="45.0 * deg" step="90.0 * deg" axis="Z"/>
        </cut>
      </yoke>
      <coil name="Q1BPR_Coil" vis="MagnetCoilVis" shape="ConeSegment">
        <placement x="Q1BPR_Coil_Center_posX" y="Q1BPR_Coil_Center_posY" z="Q1BPR_Coil_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle" phiNum="3" phiStart="90 * deg" phiStep="90 * deg"/>
        <dimensions rmin1="3.952240 * cm" rmax1="4.912360 * cm" rmin2="3.952240 * cm" rmax2="4.912360 * cm" dz="134.92 * cm / 2." sphi="-60. * deg / 2." dphi="60. * deg"/>
      </coil>
      <tube name="Q1BPR_InnerSupport_Tube" vis="MagnetSupportTubeVis">
        <placement x="Q1BPR_Coil_Center_posX" y="Q1BPR_Coil_Center_posY" z="Q1BPR_Coil_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
          <dimensions rmin="6.83 * cm / 2." rmax="7.6454 * cm / 2." half_length="148.413724 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </tube>
      <endplate name="Q1BPR_EndPlate_IP" vis="MagnetEndPlateVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <zplane z="-(140.0 * cm / 2. + 0.5 * cm)" rmin="0.0 * cm" rmax="70.961250 * cm / 2."/>
        <zplane z="-(140.0 * cm / 2. + 3.810000 * cm)" rmin="0.0 * cm" rmax="70.961250 * cm / 2."/>
        <cut>
          <placement x="14.44 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.461000 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="(0.515283 + abs(0.515283-4.019476)/2. - 8.579) * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="9.050020 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q1BPR_EndPlate_nonIP" vis="MagnetEndPlateVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <zplane z="(140.0 * cm / 2. + 0.5 * cm)" rmin="0.0 * cm" rmax="70.961250 * cm / 2."/>
        <zplane z="(140.0 * cm / 2. + 3.810000 * cm)" rmin="0.0 * cm" rmax="70.961250 * cm / 2."/>
        <cut>
          <placement x="14.44 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="5.461000 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="(0.515283 + abs(0.515283-4.019476)/2. - 8.579) * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="9.050020 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q1BPR_EndPlate2_IP" vis="MagnetEndPlateVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <zplane z="-(154.454352 * cm / 2.)" rmin="0.0 * cm" rmax="73.660000 * cm / 2."/>
        <zplane z="-(154.454352 * cm / 2. + 5.430520 * cm)" rmin="0.0 * cm" rmax="73.660000 * cm / 2."/>
        <cut>
          <placement x="14.44 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="6.400800 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="(0.515283 + abs(0.515283-4.019476)/2. - 8.579) * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="7.813040 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q1BPR_EndPlate2_nonIP" vis="MagnetEndPlateVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <zplane z="(154.454352 * cm / 2.)" rmin="0.0 * cm" rmax="73.660000 * cm / 2."/>
        <zplane z="(154.454352 * cm / 2. + 5.430520 * cm)" rmin="0.0 * cm" rmax="73.660000 * cm / 2."/>
        <cut>
          <placement x="14.44 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="6.400800 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="(0.515283 + abs(0.515283-4.019476)/2. - 8.579) * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="7.813040 * cm" half_length="400. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <yokeshield name="Q1BPR_YoketShield" vis="MagnetEndPlateVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <dimensions rmin="35.560000 * cm" rmax="36.830000 * cm" half_length="154.0 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </yokeshield>
      <heatshieldbarrel name="Q1BPR_HeatShield_Barrel" vis="MagnetHeatShieldVis">
        <placement x="6.32227 * cm" y="0 * cm" z="-829.954 * cm" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <dimensions rmin="112.395000 * cm / 2." rmax="113.030000 * cm / 2." half_length="152.400000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </heatshieldbarrel>
      <cryobarrel name="Q1BPR_Cryo_Barrel" vis="MagnetCryoVis">
        <placement x="Q1BPR_Yoke_Center_posX" y="Q1BPR_Yoke_Center_posY" z="Q1BPR_Yoke_Center_posZ" theta="Q1BPR_Yoke_Rotation_Angle"/>
        <dimensions rmin="135.255000 * cm / 2." rmax="137.160000 * cm / 2." half_length="162.560000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </cryobarrel>
    </detector>

    <!-- Q2pR magnet -->
    <detector name="Q2PR_BeamlineMagnet" type="ip6_CryostatMagnet">
      <yoke name="Q2PR_Yoke" vis="MagnetVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <dimensions rmin="0 * cm" rmax="90. * cm / 2." half_length="552.540 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
        <cut>
          <placement x="15.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="21.0 * cm / 2." half_length="4000. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="-15.663 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <!-- dimensions rmin="0 * cm" rmax="25.0 * cm / 2." half_length="4000. * cm / 2."/ (actual dimensions, temporarily commented to avoid overlap with the outdated electron beam pipe)-->
          <dimensions rmin="0 * cm" rmax="30.0 * cm / 2." half_length="4000. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </yoke>
      <coil name="Q2PR_Coil" vis="MagnetCoilVis" shape="ConeSegment">
        <placement x="Q2PR_Coil_Center_posX" y="Q2PR_Coil_Center_posY" z="Q2PR_Coil_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle" phiNum="3" phiStart="90 * deg" phiStep="90 * deg"/>
        <dimensions rmin1="6.233160 * cm" rmax1="7.056120 * cm" rmin2="6.233160 * cm" rmax2="7.056120 * cm" dz="450. * cm / 2." sphi="-60. * deg / 2." dphi="60. * deg"/>
      </coil>
      <tube name="Q2PR_InnerSupport_Tube" vis="MagnetSupportTubeVis">
        <placement x="Q2PR_Coil_Center_posX" y="Q2PR_Coil_Center_posY" z="Q2PR_Coil_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
          <dimensions rmin="11.267440 * cm / 2." rmax="12.466320 * cm / 2." half_length="486.410000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </tube>
      <endplate name="Q2PR_EndPlate_nonIP" vis="MagnetEndPlateVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <zplane z="-(552.54 * cm / 2. + 0.5 * cm)" rmin="0.0 * cm" rmax="90. * cm / 2."/>
        <zplane z="-(552.54 * cm / 2. + 3.810000 * cm)" rmin="0.0 * cm" rmax="90. * cm / 2."/>
        <cut>
          <placement x="15.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="8.458200 * cm" half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="-15.663 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <!-- dimensions rmin="0 * cm" rmax="8.458200 * cm" half_length="800. * cm / 2."/ (actual dimensions, temporarily commented to avoid overlap with the outdated electron beam pipe)-->
          <dimensions rmin="0 * cm" rmax="40 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q2PR_EndPlate_IP" vis="MagnetEndPlateVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <zplane z="(552.54 * cm / 2. + 0.5 * cm)" rmin="0.0 * cm" rmax="90. * cm / 2."/>
        <zplane z="(552.54 * cm / 2. + 3.810000 * cm)" rmin="0.0 * cm" rmax="90. * cm / 2."/>
        <cut>
          <placement x="15.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="8.458200 * cm" half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="-15.663 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="8.458200 * cm" half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q2PR_EndPlate2_nonIP" vis="MagnetEndPlateVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <zplane z="-(571.500000 * cm / 2.)" rmin="0.0 * cm" rmax="92.540074 * cm / 2."/>
        <zplane z="-(571.500000 * cm / 2. + 6.822440 * cm)" rmin="0.0 * cm" rmax="92.540074 * cm / 2."/>
        <cut>
          <placement x="15.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="13.249072 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="-15.663 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <!-- dimensions rmin="0 * cm" rmax="18.022824 * cm / 2." half_length="800. * cm / 2."/ (actual dimensions, temporarily commented to avoid overlap with the outdated electron beam pipe)-->
          <dimensions rmin="0 * cm" rmax="40 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <endplate name="Q2PR_EndPlate2_IP" vis="MagnetEndPlateVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <zplane z="(571.500000 * cm / 2.)" rmin="0.0 * cm" rmax="92.540074 * cm / 2."/>
        <zplane z="(571.500000 * cm / 2. + 6.822440 * cm)" rmin="0.0 * cm" rmax="92.540074 * cm / 2."/>
        <cut>
          <placement x="15.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="13.249072 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="-15.663 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="18.022824 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </endplate>
      <yokeshield name="Q2PR_YoketShield" vis="MagnetEndPlateVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <dimensions rmin="45.000037 * cm" rmax="46.270037 * cm" half_length="571.0 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </yokeshield>
      <heatshieldbarrel name="Q2PR_HeatShield_Barrel" vis="MagnetHeatShieldVis">
        <placement x="15.6338 * cm" y="0 * cm" z="-1224.74 * cm" theta="Q2PR_Yoke_Rotation_Angle"/>
        <dimensions rmin="135.255000 * cm / 2." rmax="135.890000 * cm / 2." half_length="561.340000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </heatshieldbarrel>
      <cryobarrel name="Q2PR_Cryo_Barrel" vis="MagnetCryoVis">
        <placement x="15.6338 * cm" y="0 * rad" z="-1224.74 * cm" theta="Q2PR_Yoke_Rotation_Angle"/>
        <dimensions rmin="165.100000 * cm / 2." rmax="167.640000 * cm / 2." half_length="566.420000 * cm / 2." sphi="0 * deg" dphi="360.0 * deg"/>
      </cryobarrel>
      <cryoend name="Q2PR_Cryo_End_nonIP" vis="MagnetCryoVis">
        <placement x="Q2PR_Yoke_Center_posX" y="Q2PR_Yoke_Center_posY" z="Q2PR_Yoke_Center_posZ" theta="Q2PR_Yoke_Rotation_Angle"/>
        <zplane z="-(552.54 * cm / 2. + 5.7 * cm)" rmin="164.465000 * cm / 2." rmax="167.640000 * cm / 2."/>
        <zplane z="-(552.54 * cm / 2. + 5.7 * cm + 30.0 * cm)" rmin="164.465000 * cm / 2." rmax="167.640000 * cm / 2."/>
        <zplane z="-(552.54 * cm / 2. + 5.7 * cm + 30.0 * cm)" rmin="0 * cm / 2." rmax="167.640000 * cm / 2."/>
        <zplane z="-(552.54 * cm / 2. + 5.7 * cm + 30.0 * cm + 1.619677 * cm)" rmin="0 * cm / 2." rmax="167.640000 * cm / 2."/>
        <cut>
          <placement x="15.0 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="0 * rad" rotZ="0 * rad"/>
          <dimensions rmin="0 * cm" rmax="13.249072 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
        <cut>
          <placement x="-15.663 * cm" y="0 * cm" z="0 * cm" rotX="0 * rad" rotY="abs(CrossingAngle)" rotZ="0 * rad"/>
          <!-- dimensions rmin="0 * cm" rmax="18.022824 * cm / 2." half_length="800. * cm / 2."/ (actual dimensions, temporarily commented to avoid overlap with the outdated electron beam pipe)-->
          <dimensions rmin="0 * cm" rmax="40 * cm / 2." half_length="800. * cm / 2."/>
          <rotation num="1" start="0 * deg" step="0 * deg" axis="Z"/>
        </cut>
      </cryoend>
    </detector>


    <detector
    name="Magnets_Q3PR_to_B1PR"
    type="CylindricalMagnetChain"
    vis="MagnetVis">
      <magnet id="0" name="Magnet_Q3PR"
        x="(Q3PR_StartX+Q3PR_EndX)/2" y="0" z="(Q3PR_StartZ+Q3PR_EndZ)/2" theta="Q3PR_Theta"
        length="Q3PR_Length" rin="Q3PR_InnerRadius" rout="Q3PR_OuterRadius">
      </magnet>
      <magnet id="0" name="Magnet_Crab1PR"
        x="Crab1PR_CenterX" y="0" z="Crab1PR_CenterZ" theta="Crab1PR_Theta"
        length="Crab1PR_Length" rin="Crab1PR_InnerRadius" rout="Crab1PR_OuterRadius">
      </magnet>
      <magnet id="0" name="Magnet_Crab2PR"
        x="Crab2PR_CenterX" y="0" z="Crab2PR_CenterZ" theta="Crab2PR_Theta"
        length="Crab2PR_Length" rin="Crab2PR_InnerRadius" rout="Crab2PR_OuterRadius">
      </magnet>
      <magnet id="0" name="Magnet_Crab3PR"
        x="Crab3PR_CenterX" y="0" z="Crab3PR_CenterZ" theta="Crab3PR_Theta"
        length="Crab3PR_Length" rin="Crab3PR_InnerRadius" rout="Crab3PR_OuterRadius">
      </magnet>
      <magnet id="0" name="Magnet_Q4PR"
        x="Q4PR_CenterX" y="0" z="Q4PR_CenterZ" theta="Q4PR_Theta"
        length="Q4PR_Length" rin="Q4PR_InnerRadius" rout="Q4PR_OuterRadius">
      </magnet>
      <magnet id="0" name="Magnet_B1PR"
        x="B1PR_CenterX" y="0" z="B1PR_CenterZ" theta="B1PR_Theta"
        length="B1PR_Length" rin="B1PR_InnerRadius" rout="B1PR_OuterRadius">
      </magnet>
     </detector>


    <comment> Hadron side beam pipe volumes </comment>

    <detector
    name="Pipe_Q1APR_to_B1PR"
    type="BeamPipeChain"
    wall_thickness="2*mm">
      <pipe id="0" name="Pipe_to_Q1APR"
        xcenter="(Hadron_Beampipe_End*sin(CrossingAngle) + Q1APR_StartX)/2." zcenter="(Hadron_Beampipe_End + Q1APR_StartZ)/2."
        length="(Hadron_Beampipe_End - Q1APR_StartZ)/cos(CrossingAngle)" theta="CrossingAngle"
        rout1="Hadron_Beampipe_Rad" rout2="Hadron_Beampipe_Rad">
      </pipe>
      <pipe id="1" name="Pipe_in_Q1APR"
        xcenter="(Q1APR_StartX + Q1APR_EndX)/2." zcenter="(Q1APR_StartZ + Q1APR_EndZ)/2."
        length="Q1APR_Length" theta="Q1APR_Theta"
        rout1="Q1APR_InnerRadius" rout2="Q1APR_InnerRadius">
      </pipe>
      <pipe id="2" name="Pipe_Q1APR_to_Q1BPR"/>
      <pipe id="3" name="Pipe_in_Q1BPR"
        xcenter="(Q1BPR_StartX + Q1BPR_EndX)/2." zcenter="(Q1BPR_StartZ + Q1BPR_EndZ)/2."
        length="Q1BPR_Length" theta="Q1BPR_Theta"
        rout1="Q1BPR_InnerRadius" rout2="Q1BPR_InnerRadius">
      </pipe>
      <pipe id="4" name="Pipe_Q1BPR_to_Q2PR"/>
      <pipe id="5" name="Pipe_in_Q2PR"
        xcenter="(Q2PR_StartX + Q2PR_EndX)/2." zcenter="(Q2PR_StartZ + Q2PR_EndZ)/2."
        length="Q2PR_Length" theta="Q2PR_Theta"
        rout1="Q2PR_InnerRadius" rout2="Q2PR_InnerRadius">
      </pipe>
      <pipe id="6" name="Pipe_Q2PR_to_Q3PR"/>
      <pipe id="7" name="Pipe_in_Q3PR"
        xcenter="Q3PR_CenterX" zcenter="Q3PR_CenterZ"
        length="Q3PR_Length" theta="Q3PR_Theta"
        rout1="Q3PR_InnerRadius" rout2="Q3PR_InnerRadius">
      </pipe>
      <pipe id="8" name="Pipe_Q3PR_to_Crab1PR"/>
      <pipe id="9" name="Pipe_in_Crab1PR"
        xcenter="Crab1PR_CenterX" zcenter="Crab1PR_CenterZ"
        length="Crab1PR_Length" theta="Crab1PR_Theta"
        rout1="Crab1PR_InnerRadius" rout2="Crab1PR_InnerRadius">
      </pipe>
      <pipe id="10" name="Pipe_in_Crab2PR"
        xcenter="Crab2PR_CenterX" zcenter="Crab2PR_CenterZ"
        length="Crab2PR_Length" theta="Crab2PR_Theta"
        rout1="Crab2PR_InnerRadius" rout2="Crab2PR_InnerRadius">
      </pipe>
      <pipe id="11" name="Pipe_Crab2PR_to_Crab3PR"/>
      <pipe id="12" name="Pipe_in_Crab3PR"
        xcenter="Crab3PR_CenterX" zcenter="Crab3PR_CenterZ"
        length="Crab3PR_Length" theta="Crab3PR_Theta"
        rout1="Crab3PR_InnerRadius" rout2="Crab3PR_InnerRadius">
      </pipe>
      <pipe id="13" name="Pipe_Crab3PR_to_Q4PR"/>
      <pipe id="14" name="Pipe_in_Q4PR"
        xcenter="Q4PR_CenterX" zcenter="Q4PR_CenterZ"
        length="Q4PR_Length" theta="Q4PR_Theta"
        rout1="Q4PR_InnerRadius" rout2="Q4PR_InnerRadius">
      </pipe>
      <pipe id="15" name="Pipe_Q4PR_to_B1PR"/>
      <pipe id="16" name="Pipe_in_B1PR"
        xcenter="B1PR_CenterX" zcenter="B1PR_CenterZ"
        length="B1PR_Length" theta="B1PR_Theta"
        rout1="B1PR_InnerRadius" rout2="B1PR_InnerRadius">
      </pipe>
    </detector>

  </detectors>
</lccdd>
