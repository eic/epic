<lccdd>

  <display>
  </display>
  <define>
    <comment> Primary directions for the tracker </comment>
    <constant name="TrackerPrimaryAngle"             value="2*atan(exp(-1.109))" />
    <constant name="TrackerForwardAngle1"            value="2*atan(exp(-1.6472))" />
    <constant name="TrackerForwardAngle2"            value="2*atan(exp(-1.3899))" />
    <constant name="TrackerBackwardAngle1"           value="2*atan(exp(-1.5166))" />
    <!--constant name="TrackerBackwardAngle2"           value="tan(2*atan(exp(-1.6685)))" /-->

    <comment> Main parameters for the vertex tracker </comment>
    <constant name="VertexBarrel_length"             value="280.0*mm"/>
    <constant name="VertexBarrel_rmin"               value="3.3*cm"/>
    <constant name="VertexBarrel_offset"             value="1.05*cm"/>
    <constant name="VertexBarrel_count"              value="3"/>

    <comment> Main parameters for the Sagitta layer geometry </comment>
    <constant name="SagittaBarrel_rmin"              value="21.0*cm"/>
    <constant name="SagittaBarrel_offset"            value="1.68*cm"/>
    <constant name="SagittaBarrel_angle"             value="TrackerPrimaryAngle"/>
    <constant name="SagittaBarrel_dz"                value="2.0*cm"/>
    <constant name="SagittaBarrel_count"             value="2"/>
    <comment> barrel length: 2R/tan(angle) - dz </comment>

    <comment> Service/Support setup </comment>
    <constant name="VertexSupportCyl_rmin"           value="6.3*cm"/>
    <constant name="SagittaSupportCyl_rmin"          value="23.5*cm"/>
    <constant name="TrackerSupportCyl_rmin"          value="41.5*cm"/>
    <comment> These may belong in definitions.xml </comment>
    <constant name="InnerTrackerEndcapP_zmax"        value="173.0*cm"/>
    <constant name="InnerTrackerEndcapN_zmax"        value="147.47*cm"/>
    <comment> Endcap structures </comment>
    <comment> The forward outer cone is NOT projective </comment>
    <constant name="ForwardEndcapSupportCone_rmin1"  value="85*cm" />
    <constant name="ForwardEndcapSupportCone_rmin2"  value="100*cm" />
    <constant name="ForwardEndcapSupportCone_zmax"   value="190*cm" />
    <constant name="BackwardEndcapSupportCyl_zmax"   value="300*cm" />

    <comment> Main parameters for the positive silicon disks </comment>
    <constant name="InnerTrackerEndcapP_zmin"        value="25.0*cm" />
    <constant name="InnerTrackerEndcapP_rmin"        value="Beampipe_rmax + 3.2*mm" />
    <constant name="InnerTrackerEndcapP_rmax"        value="InnerTrackerEndcapP_zmin * tan(TrackerPrimaryAngle) * .9995" />
    <constant name="TrackerEndcapPDisk1_zmin"        value="52.0*cm" />
    <constant name="TrackerEndcapPDisk1_rmin"        value="Beampipe_rmax + 3.2*mm" />
    <constant name="TrackerEndcapPDisk1_rmax"        value="TrackerEndcapPDisk1_zmin * tan(TrackerPrimaryAngle) * .96" />
    <constant name="TrackerEndcapPDisk2_zmin"        value="73.0*cm" />
    <constant name="TrackerEndcapPDisk2_rmin"        value="Beampipe_rmax + 13.2*mm" />
    <constant name="TrackerEndcapPDisk2_rmax"        value="TrackerSupportCyl_rmin * .98" />
    <constant name="TrackerEndcapPDisk3_zmin"        value="106.0*cm" />
    <constant name="TrackerEndcapPDisk3_rmin"        value="Beampipe_rmax + 23.2*mm" />
    <constant name="TrackerEndcapPDisk3_rmax"        value="TrackerEndcapPDisk3_zmin * tan(TrackerForwardAngle1) * 0.98" />
    <constant name="TrackerEndcapPDisk4_zmin"        value="125.0*cm" />
    <constant name="TrackerEndcapPDisk4_rmin"        value="Beampipe_rmax + 43.2*mm" />
    <constant name="TrackerEndcapPDisk4_rmax"        value="TrackerEndcapPDisk4_zmin * tan(TrackerForwardAngle1) * 0.87" />

    <comment> Main parameters for the negative silicon disks (will be reflected, so positive z-values here)
              Values such that the disk dimensions are identical to the positive endcap. 
              This currently leads to rather large gaps with the support/service material etc.
    </comment>
    <constant name="InnerTrackerEndcapN_zmin"        value="InnerTrackerEndcapP_zmin" />
    <constant name="InnerTrackerEndcapN_rmin"        value="InnerTrackerEndcapP_rmin" />
    <constant name="InnerTrackerEndcapN_rmax"        value="InnerTrackerEndcapP_rmax" />
    <constant name="TrackerEndcapNDisk1_zmin"        value="TrackerEndcapPDisk1_zmin" />
    <constant name="TrackerEndcapNDisk1_rmin"        value="TrackerEndcapPDisk1_rmin" />
    <constant name="TrackerEndcapNDisk1_rmax"        value="TrackerEndcapPDisk1_rmax" />
    <constant name="TrackerEndcapNDisk2_zmin"        value="79.0*cm" />
    <constant name="TrackerEndcapNDisk2_rmin"        value="TrackerEndcapPDisk2_rmin" />
    <constant name="TrackerEndcapNDisk2_rmax"        value="TrackerEndcapPDisk2_rmax" />
    <constant name="TrackerEndcapNDisk3_zmin"        value="TrackerEndcapPDisk3_zmin" />
    <constant name="TrackerEndcapNDisk3_rmin"        value="TrackerEndcapPDisk3_rmin" />
    <constant name="TrackerEndcapNDisk3_rmax"        value="TrackerEndcapPDisk3_rmax" />

  </define>

  <detectors>
    <detector id="VertexSubAssembly_0_ID"
      name="VertexBarrelSubAssembly"
      type="DD4hep_SubdetectorAssembly"
      vis="TrackerSubAssemblyVis">
      <composite name="VertexBarrel" />
    </detector>
    <detector id="TrackerSubAssembly_0_ID"
      name="InnerTrackerSubAssembly"
      type="DD4hep_SubdetectorAssembly"
      vis="TrackerSubAssemblyVis">
      <composite name="InnerTrackerEndcapN"/>
      <composite name="InnerTrackerEndcapP"/>
    </detector>
    <detector id="TrackerSubAssembly_1_ID"
      name="SagittaSubAssembly"
      type="DD4hep_SubdetectorAssembly"
      vis="TrackerSubAssemblyVis">
      <composite name="SagittaBarrel"/>
    </detector>
    <detector id="TrackerSubAssembly_2_ID"
      name="TrackerSubAssembly"
      type="DD4hep_SubdetectorAssembly"
      vis="TrackerSubAssemblyVis">
      <composite name="TrackerEndcapN"/>
      <!--composite name="rwellbarrel"/-->
      <composite name="TrackerEndcapP"/>
    </detector>
    <!--
    <detector id="TrackerSubAssembly_3_ID"
      name="EcalBarrelSubAssembly"
      type="DD4hep_SubdetectorAssembly"
      vis="TrackerSubAssemblyVis">
    </detector>
    <detector id="TrackerSubAssembly_4_ID"
      name="ForwardBackwardTrackerSubAssembly"
      type="DD4hep_SubdetectorAssembly"
      vis="TrackerSubAssemblyVis">
      <composite name="ForwardGEM"/>
      <composite name="BackwardNullTracker"/>
    </detector>
    <detector id="TrackerCompositeBarrel_0_ID"
      name="MedialTrackerCompositeBarrel"
      type="epic_CompositeTracker"
      actsType="barrel"
      vis="TrackerSubAssemblyVis">
      <position x="0*cm" y="0*cm" z="0*um" />
      <composite name="MedialTrackerBarrel"/>
      <composite name="BarrelTOF"/>
    </detector>
    <detector id="TrackerCompositeEndcapN_0_ID"
      name="OuterTrackerCompositeEndcapN"
      type="epic_CompositeTracker"
      actsType="endcap"
      vis="TrackerSubAssemblyVis">
      <position x="0*cm" y="0*cm" z="-1*um" />
      <composite name="OuterTrackerEndcapN"/>
      <composite name="GEMEndcapN"/>
    </detector>
    <detector id="TrackerCompositeEndcapP_0_ID"
      name="OuterTrackerCompositeEndcapP"
      type="epic_CompositeTracker"
      actsType="endcap"
      vis="TrackerSubAssemblyVis">
      <position x="0*cm" y="0*cm" z="0*cm" />
      <composite name="OuterTrackerEndcapP"/>
      <composite name="GEMEndcapP"/>
    </detector>
    <detector id="TrackerCompositeEndcapN_1_ID"
      name="BackwardNullTracker"
      type="epic_CompositeTracker"
      actsType="endcap"
      vis="TrackerSubAssemblyVis">
      <position x="0*cm" y="0*cm" z="-1*um" />
    </detector-->

  </detectors>

  <documentation>
      ### Material map for ACTS
      https://eicweb.phy.anl.gov/EIC/detectors/athena/-/issues/127
  </documentation>
  <plugins>
    <plugin name="epic_FileLoader">
      <arg value="cache:$DETECTOR_PATH"/>
      <arg value="file:calibrations/materials-map.cbor"/>
      <arg value="url:https://eicweb.phy.anl.gov/EIC/detectors/athena/uploads/4a4e7c8eb6089b634d762d112c89bd5d/material-maps.cbor"/>
    </plugin>
  </plugins>

  <include ref="tracker/vertex_its3_3layers.xml"/>
  <include ref="tracker/sagitta_its3_curved.xml"/>
  <include ref="tracker/disks_its3_5fw4bw.xml"/>
  <include ref="tracker/support_reference.xml"/>

</lccdd>
